[supervisord]
logfile=%(here)s/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=%(here)s/supervisord.pid
nodaemon=false
minfds=1024
minprocs=200

[unix_http_server]
file=%(here)s/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix://%(here)s/supervisor.sock

[program:reranker-serve]
# Command to run the application
command=%(here)s/.venv/bin/uvicorn src.main:app --host 0.0.0.0 --port 8000 --log-level info

# Working directory (project root)
directory=%(here)s

# Environment variables
environment=
    PATH="%(here)s/.venv/bin:%(ENV_PATH)s",
    VIRTUAL_ENV="%(here)s/.venv",
    PYTHONPATH="%(here)s",
    RERANKER_CONFIG_PATH="%(here)s/config.yml"

# User to run the process as (comment out to run as current user)
# user=your-username

# Process priority
priority=999

# Auto-start on supervisor start
autostart=true

# Auto-restart if process dies
autorestart=true

# Number of seconds to wait for the process to start
startsecs=10

# Number of retries before giving up
startretries=3

# Signal to send to stop the process
stopsignal=TERM

# Number of seconds to wait for process to stop gracefully
stopwaitsecs=10

# Redirect stderr to stdout
redirect_stderr=true

# Output log files
stdout_logfile=%(here)s/logs/reranker-serve.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=%(here)s/logs/reranker-serve-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10
