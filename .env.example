# Environment Configuration for Reranker Service
# Copy this file to .env and modify as needed

# =============================================================================
# Server Configuration
# =============================================================================
RERANKER_HOST=0.0.0.0
RERANKER_PORT=8000
RERANKER_WORKERS=1
RERANKER_RELOAD=false

# =============================================================================
# Model Configuration
# =============================================================================
# Model name or HuggingFace model ID
# Supported models:
#   - BAAI/bge-reranker-v2-m3 (multilingual, recommended)
#   - BAAI/bge-reranker-large (English)
#   - BAAI/bge-reranker-base (smaller, faster)
#   - Qwen/Qwen3-Reranker-0.6B (Qwen3-based, multilingual)
#   - Qwen/Qwen3-Reranker-4B (Qwen3-based, larger)
#   - Qwen/Qwen3-Reranker-8B (Qwen3-based, best quality)
# Note: Qwen3-Reranker models use a different architecture (CausalLM) and 
#       are automatically detected and handled differently.
RERANKER_MODEL_NAME=BAAI/bge-reranker-v2-m3

# Local path to load model from disk (optional)
# If set, will load from this path instead of downloading
# RERANKER_MODEL_PATH=/path/to/local/model

# Directory to cache downloaded models
RERANKER_MODEL_CACHE_DIR=./models

# Enable offline mode (no internet access, requires local model)
RERANKER_USE_OFFLINE_MODE=false

# =============================================================================
# Inference Configuration
# =============================================================================
# Maximum sequence length
RERANKER_MAX_LENGTH=512

# Batch size for inference
RERANKER_BATCH_SIZE=32

# Normalize scores to 0-1 range
RERANKER_NORMALIZE_SCORES=true

# =============================================================================
# Device Configuration
# =============================================================================
# Device to use: cuda, mps, cpu, or leave empty for auto-detect
# RERANKER_DEVICE=

# Force CPU-only mode (disables CUDA/MPS completely)
# Useful for environments without GPU or to ensure reproducibility
RERANKER_FORCE_CPU_ONLY=false

# Use FP16 precision (faster on CUDA, may cause issues on MPS)
RERANKER_USE_FP16=true

# Fallback to CPU if MPS operation fails
RERANKER_MPS_FALLBACK_TO_CPU=true

# =============================================================================
# API Configuration
# =============================================================================
# API key for authentication (optional)
# If set, all requests must include Authorization: Bearer <key>
# RERANKER_API_KEY=your-secret-key

# Enable CORS
RERANKER_ENABLE_CORS=true

# Allowed CORS origins (comma-separated, or * for all)
RERANKER_CORS_ORIGINS=*

# =============================================================================
# Load Balancer Configuration
# =============================================================================
# Enable load balancer mode (route requests to multiple backends)
RERANKER_LOAD_BALANCER_ENABLED=false

# Path to load balancer YAML configuration file
RERANKER_CONFIG_PATH=./reranker_config.yaml

# =============================================================================
# Async Engine Configuration (vLLM-inspired)
# =============================================================================
# Enable async engine for concurrent request handling (recommended)
RERANKER_ENABLE_ASYNC_ENGINE=true

# Maximum concurrent batches being processed simultaneously
RERANKER_MAX_CONCURRENT_BATCHES=2

# Number of threads for model inference in thread pool
RERANKER_INFERENCE_THREADS=1

# Maximum number of requests per batch
RERANKER_MAX_BATCH_SIZE=32

# Maximum query-document pairs per batch
RERANKER_MAX_BATCH_PAIRS=1024

# Wait timeout for batch accumulation (seconds) - lower = less latency, higher = better batching
RERANKER_BATCH_WAIT_TIMEOUT=0.01

# Maximum queue size for pending requests
RERANKER_MAX_QUEUE_SIZE=1000

# Request timeout (seconds) - max time to wait for a request to complete
RERANKER_REQUEST_TIMEOUT=60.0

# =============================================================================
# HTTP Client / Proxy Configuration
# =============================================================================
# Trust environment variables for proxy settings (HTTP_PROXY, HTTPS_PROXY, NO_PROXY)
# Set to false to ignore proxy and make direct connections (recommended for internal services)
# Set to true to use system proxy settings
RERANKER_TRUST_ENV=false

# =============================================================================
# Logging (structlog)
# =============================================================================
# Log level: 'critical', 'error', 'warning', 'info', 'debug', 'trace'
RERANKER_LOG_LEVEL=info

# Output logs in JSON format (recommended for production/log aggregation)
RERANKER_JSON_LOGS=false

# Directory to store log files (default: ./logs)
RERANKER_LOG_DIR=./logs

# Number of days to keep old log files (for cleanup on startup)
RERANKER_LOG_RETENTION_DAYS=7

# Maximum size of a single log file in bytes before rotation (default: 10MB)
RERANKER_LOG_MAX_BYTES=10485760

# Number of backup log files to keep (rotated by size)
RERANKER_LOG_BACKUP_COUNT=5
